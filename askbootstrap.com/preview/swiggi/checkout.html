<!doctype html>
<html lang="en">
  <!-- Mirrored from askbootstrap.com/preview/swiggi/checkout.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Sep 2024 06:30:23 GMT -->
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="Askbootstrap" />
    <meta name="author" content="Askbootstrap" />
    <link rel="icon" type="image/png" href="img/fav.png" />
    <!-- Bootstrap CSS -->

    <title>Swiggi - Online Food Ordering Website Mobile Template</title>
    <style>
      #logout {
        display: none;
      }

      #locationName {
        display: none;
      }
      .empty-cart-img-container {
        display: flex;
        justify-content: center; /* Center the image horizontally */
      }

      .empty-cart-img {
        width: 150px; /* Adjust the width */
        height: 150px; /* Adjust the height */
        object-fit: contain; /* Ensure the image maintains aspect ratio */
        margin-top: 20px;
      }
      /* Custom modal styling */
#cartModal .modal-dialog {
  max-width: 500px; /* Full width on small screens */
  margin: 0 auto; /* Center the modal horizontally */
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 90vh; /* Modal vertical centering */
}

#cartModal .modal-content {
  max-height: 80vh; /* Adjust height for small screens */
  width: 90%; /* Optional: Set modal content width to 90% of screen */
}

@media (max-width: 576px) {
  #cartModal .modal-dialog {
    max-width: 50%; /* Full width on small screens */
    margin: 0 auto; /* Center horizontally */
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 80vh; /* Vertical centering */
  }
  #cartModal .modal-content {
    max-height: 80vh; /* Adjust height for small screens */
    width: 90%; /* Optional: Set modal content width to 90% of screen */
  }
}

    </style>
    <link rel="stylesheet" type="text/css" href="vendor/slick/slick.min.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="vendor/slick/slick-theme.min.css"
    />

    <link href="vendor/icons/feather.css" rel="stylesheet" type="text/css" />

    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />

    <link href="./img/css/style.css" rel="stylesheet" />

    <link href="vendor/sidebar/demo.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body class="bg-light fixed-bottom-bar">
    <div class="osahan-checkout">
      <div
        class="bg-primary border-bottom px-3 pt-3 pb-5 d-flex align-items-center"
      >
        <a class="toggle" href="#"><span></span></a>
        <h4 class="font-weight-bold m-0 text-white pl-5">Order</h4>
        <a class="text-white font-weight-bold ml-auto" href="home.html">
          Close</a
        >
      </div>

      <div class="p-3 osahan-cart-item">
        <div
          class="d-flex mb-3 osahan-cart-item-profile bg-white shadow rounded p-3 mt-n5"
        >
          <img
            alt="osahan"
            src="img/starter1.jpg"
            class="mr-3 rounded-circle img-fluid"
          />
          <div class="d-flex flex-column">
            <h6 class="mb-1 font-weight-bold">Spice Hut Indian Restaurant</h6>
            <p class="mb-0 small text-muted">
              <i class="feather-map-pin"></i> 2036 2ND AVE, NEW YORK, NY 10029
            </p>
          </div>
        </div>

        <div id="cart-items"></div>

        <div id="cart-items-container">
          <!-- Cart items will be dynamically displayed here -->
        </div>
        <a
          id="confirmButton"
          class="item-subtotal btn btn-success btn-block btn-lg fixed-bottom"
          href="#"
          data-bs-toggle="modal"
          data-bs-target="#cartModal"
        >
          <span id="total-price">Pay $0.00</span
          ><i class="icofont-long-arrow-right"></i
        ></a>
      </div>
    </div>

    
    <!-- Modal -->
    <!-- <div
      class="modal fade"
      id="cartModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" style="max-width: 400px">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabel">
              <span style="color: green">Confirm Your WhatsApp Number</span>
            </h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
              style="
                padding: 10px;
                background-color: rgb(227, 61, 117);
                color: azure;
                border: none;
                border-radius: 5px;
              "
            >
              close
            </button>
          </div>
          <div class="modal-body">
            <form id="whatsappForm">
              <div class="mb-3">
                <input
                  type="text"
                  id="customerName"
                  class="form-control"
                  placeholder="Customer Name"
                  required
                />
              </div>
              <div class="input-group mt-3">
                <input
                  type="tel"
                  id="customerNumber"
                  class="form-control"
                  placeholder="WhatsApp Number"
                  required
                />
              </div>
              <p class="text-muted" style="font-size: 13px">
                Yes, I want to receive important information & updates on my
                WhatsApp.
              </p>
            </form>
          </div>

          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-danger"
              id="continueButton"
              onclick="sendCartDataToServer()"
              style="
                background-color: rgb(227, 61, 117);
                color: aliceblue;
                border-radius: 5px;
              "
            >
              Confirm
            </button>
          </div>
        </div>
      </div>
    </div> -->

<!-- Modal -->
<div
  class="modal fade"
  id="cartModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div
    class="modal-dialog modal-dialog-centered"
    style="max-width: 350px;"
  >
    <div class="modal-content" style="min-height: 250px; padding: 10px;">
      <div class="modal-header" style="padding: 10px;">
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          <span style="color: green">Confirm Your WhatsApp Number</span>
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
          style="
            padding: 9px;
            background-color: rgb(227, 61, 117);
            color: azure;
            border: none;
            border-radius: 5px;
            width: 70px;
          "
        >
          close
        </button>
      </div>
      <div class="modal-body" style="padding: 10px;">
        <form id="whatsappForm">
          <div class="mb-2">
            <input
              type="text"
              id="customerName"
              class="form-control"
              placeholder="Customer Name"
              required
            />
          </div>
          <div class="input-group mt-2">
            <input
              type="tel"
              id="customerNumber"
              class="form-control"
              placeholder="WhatsApp Number"
              required
            />
          </div>
          <p class="text-muted" style="font-size: 12px; margin-top: 5px;">
            Yes, I want to receive important information & updates on my
            WhatsApp.
          </p>
        </form>
      </div>

      <div class="modal-footer" style="padding: 10px;">
        <button
          type="button"
          class="btn btn-danger"
          id="continueButton"
          onclick="sendCartDataToServer()"
          style="
            background-color: rgb(227, 61, 117);
            color: aliceblue;
            border-radius: 5px;
          "
        >
          Confirm
        </button>
      </div>
    </div>
  </div>
</div>



    <!-- Modal for OTP -->
    <div
      class="modal fade"
      id="exampleModal1"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabelName"></h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="row justify-content-center">
              <div class="col-md-8">
                <form>
                  <div class="mb-3">
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control mx-2"
                        id="otp1"
                        maxlength="1"
                        required
                      />
                      <input
                        type="text"
                        class="form-control mx-2"
                        id="otp2"
                        maxlength="1"
                        required
                      />
                      <input
                        type="text"
                        class="form-control mx-2"
                        id="otp3"
                        maxlength="1"
                        required
                      />
                      <input
                        type="text"
                        class="form-control mx-2"
                        id="otp4"
                        maxlength="1"
                        required
                      />
                    </div>
                    <div class="float-end mt-1">
                      <a href="#">RESEND OTP</a>
                    </div>
                  </div>

                  <!-- <button type="submit" href="cart.html" class="btn btn-danger mt-3"
                                  id="continueButton">Continue</button> -->
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- OTP for sending sms -->
    <div
      class="modal fade"
      id="exampleModal1"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="exampleModalLabelName"></h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="row justify-content-center">
              <div class="col-md-8">
                <form>
                  <div class="mb-3">
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control mx-2"
                        id="otp1"
                        maxlength="1"
                        required
                      />
                      <input
                        type="text"
                        class="form-control mx-2"
                        id="otp2"
                        maxlength="1"
                        required
                      />
                      <input
                        type="text"
                        class="form-control mx-2"
                        id="otp3"
                        maxlength="1"
                        required
                      />
                      <input
                        type="text"
                        class="form-control mx-2"
                        id="otp4"
                        maxlength="1"
                        required
                      />
                    </div>
                    <div class="float-end mt-1">
                      <a href="#">RESEND OTP</a>
                    </div>
                  </div>

                  <!-- <button type="submit" href="cart.html" class="btn btn-danger mt-3"
                                  id="continueButton">Continue</button> -->
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="locationName"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>
    <nav id="main-nav">
      <ul class="second-nav">
        <li>
          <a href="index.html"><i class="feather-grid mr-2"></i> Intro</a>
        </li>
        <li>
          <a href="landing.html"><i class="feather-layers mr-2"></i> Landing</a>
        </li>
        <li>
          <a href="home.html"><i class="feather-home mr-2"></i> Homepage</a>
        </li>
        <li>
          <a href="#"><i class="feather-edit-2 mr-2"></i> Authentication</a>
          <ul>
            <li><a href="login.html">Login</a></li>
            <li><a href="signup.html">Register</a></li>
            <li><a href="forgot_password.html">Forgot Password</a></li>
            <li><a href="verification.html">Verification</a></li>
            <li><a href="location.html">Location</a></li>
            <li><a href="select_country.html">Select Country</a></li>
          </ul>
        </li>
        <li>
          <a href="trending.html"
            ><i class="feather-trending-up mr-2"></i> Trending</a
          >
        </li>
        <li>
          <a href="most_popular.html"
            ><i class="feather-award mr-2"></i> Most Popular</a
          >
        </li>
        <li>
          <a href="restaurant.html"
            ><i class="feather-paperclip mr-2"></i> Restaurant Detail</a
          >
        </li>
        <li>
          <a href="recipe.html"
            ><i class="feather-file-text mr-2"></i> Recipe</a
          >
        </li>
        <li>
          <a href="cart.html"><i class="feather-list mr-2"></i> Checkout</a>
        </li>
        <li>
          <a href="map.html"><i class="feather-map-pin mr-2"></i> Live Map</a>
        </li>
        <li>
          <a href="payment.html"
            ><i class="feather-credit-card mr-2"></i> Payment</a
          >
        </li>
        <li>
          <a href="#"><i class="feather-user mr-2"></i> Profile</a>
          <ul>
            <li><a href="profile.html">Profile</a></li>
            <li><a href="favorites.html">Favorites</a></li>
          </ul>
        </li>
        <li>
          <a href="#"><i class="feather-book mr-2"></i> Pages</a>
          <ul>
            <li><a href="filters.html">Filters</a></li>
            <li><a href="terms.html">Terms & conditions</a></li>
            <li><a href="faq.html">FAQ</a></li>
            <li><a href="privacy.html">Privacy & Policy</a></li>
            <li><a href="contact-us.html">Contact Us</a></li>
          </ul>
        </li>
        <li>
          <a href="#"><i class="feather-alert-triangle mr-2"></i> Error</a>
          <ul>
            <li><a href="not-found.html">Not Found</a></li>
            <li><a href="maintence.html"> Maintence</a></li>
            <li><a href="coming-soon.html">Coming Soon</a></li>
          </ul>
        </li>
        <li>
          <a href="#"
            ><i class="feather-link mr-2"></i> Navigation Link Example</a
          >
          <ul>
            <li>
              <a href="#">Link Example 1</a>
              <ul>
                <li>
                  <a href="#">Link Example 1.1</a>
                  <ul>
                    <li><a href="#">Link</a></li>
                    <li><a href="#">Link</a></li>
                    <li><a href="#">Link</a></li>
                    <li><a href="#">Link</a></li>
                    <li><a href="#">Link</a></li>
                  </ul>
                </li>
                <li>
                  <a href="#">Link Example 1.2</a>
                  <ul>
                    <li><a href="#">Link</a></li>
                    <li><a href="#">Link</a></li>
                    <li><a href="#">Link</a></li>
                    <li><a href="#">Link</a></li>
                  </ul>
                </li>
              </ul>
            </li>
            <li><a href="#">Link Example 2</a></li>
            <li><a href="#">Link Example 3</a></li>
            <li><a href="#">Link Example 4</a></li>
            <li data-nav-custom-content>
              <div class="custom-message">
                You can add any custom content to your navigation items. This
                text is just an example.
              </div>
            </li>
          </ul>
        </li>
      </ul>
      <ul class="bottom-nav">
        <li class="email">
          <a class="text-danger" href="home.html">
            <p class="h5 m-0"><i class="feather-home text-danger"></i></p>
            Home
          </a>
        </li>
        <li class="github">
          <a href="faq.html">
            <p class="h5 m-0"><i class="feather-message-circle"></i></p>
            FAQ
          </a>
        </li>
        <li class="ko-fi">
          <a href="contact-us.html">
            <p class="h5 m-0"><i class="feather-phone"></i></p>
            Help
          </a>
        </li>
      </ul>
    </nav>

    <!-- Bootstrap JS with Popper -->

    <script
      src="vendor/jquery/jquery.min.js"
      type="91829b7bdd9927fe0b329f0a-text/javascript"
    ></script>
    <script
      src="vendor/bootstrap/js/bootstrap.bundle.min.js"
      type="91829b7bdd9927fe0b329f0a-text/javascript"
    ></script>
    <script
      type="91829b7bdd9927fe0b329f0a-text/javascript"
      src="vendor/slick/slick.min.js"
    ></script>
    <script
      type="91829b7bdd9927fe0b329f0a-text/javascript"
      src="vendor/sidebar/hc-offcanvas-nav.js"
    ></script>
    <script
      src="js/osahan.js"
      type="91829b7bdd9927fe0b329f0a-text/javascript"
    ></script>
    <script
      src="../../cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js"
      data-cf-settings="91829b7bdd9927fe0b329f0a-|49"
      defer
    ></script>

    <!-- <script>
      let url;

      document.addEventListener("DOMContentLoaded", () => {
        loadEnvironmentVariables();
        loadSessionData();
        displayLocationName();
      });

      // Load environment variables from env.json
      async function loadEnvironmentVariables() {
        try {
          const response = await fetch("/env.json");
          const data = await response.json();
          url = data.URL;
          restaurantId = localStorage.getItem("urlSegment");
          console.log("URL:", url, "Restaurant ID:", restaurantId);
          const locationId = sessionStorage.getItem("selectedLocationId");
          console.log("Location ID:", locationId);
        } catch (error) {
          console.error("Error fetching env.json:", error);
        }
      }

      // Load session data and check areaName
      function loadSessionData() {
        const areaName = sessionStorage.getItem("areaName");
        if (!areaName) {
          window.location.href = "home.html"; // Redirect if areaName is not set
          return;
        }
        console.log("Area Name:", areaName);
        loadCartItems(); // Load cart items after session data is confirmed
      }

      // Display location name in the UI
      function displayLocationName() {
        const location = sessionStorage.getItem("selectedLocationName");
        if (location) {
          document.getElementById("locationName").innerText = location;
        }
      }

      // Load and render cart items from sessionStorage
      function loadCartItems() {
        const cart = JSON.parse(sessionStorage.getItem("cart")) || [];
        renderCartItems(cart);
      }

      // Render cart items
      function renderCartItems(cart) {
        const cartItemsContainer = document.getElementById(
          "cart-items-container"
        );
        const totalPriceElement = document.getElementById("total-price");
        const payNowButtonSpan = document.querySelector(".item-subtotal span");

        cartItemsContainer.innerHTML = ""; // Clear previous cart content
        let totalPrice = 0;

        if (cart.length === 0) {
          renderEmptyCart(); // Display empty cart UI
          totalPriceElement.textContent = "0.00";
          payNowButtonSpan.textContent = `Pay ₹0.00`;
          return;
        }

        cart.forEach((cartItem, index) => {
          const itemDiv = createCartItemElement(cartItem, index);
          cartItemsContainer.appendChild(itemDiv);
          totalPrice += cartItem.price * cartItem.quantity; // Calculate total price
        });

        totalPriceElement.textContent = totalPrice.toFixed(2);
        payNowButtonSpan.textContent = `Pay ₹${totalPrice.toFixed(2)}`;
      }

      // Create a cart item element
      function createCartItemElement(cartItem, index) {
        const itemDiv = document.createElement("div");
        itemDiv.classList.add("cart-item");

        itemDiv.innerHTML = `
          <div class="p-3 border-bottom gold-members">
            <span class="count-number float-right">
              <button type="button" class="btn-sm left btn-dec btn btn-outline-secondary" data-index="${index}">-</button>
              <input class="count-number-input" type="text" readonly value="${cartItem.quantity}" />
              <button type="button" class="btn-sm right btn-inc btn btn-outline-secondary" data-index="${index}">+</button>
            </span>
            <div class="media">
              <div class="mr-3 font-weight-bold text-danger non_veg">.</div>
              <div class="media-body">
                <h6 class="mb-1">${cartItem.name}</h6>
                <p class="text-muted mb-0">₹<span class="item-price">${parseFloat(cartItem.price).toFixed(2)}</span></p>
              </div>
            </div>
          </div>`;
        
        return itemDiv;
        
      }

      // Handle quantity updates for cart items
      document
        .getElementById("cart-items-container")
        .addEventListener("click", (event) => {
          const index = event.target.getAttribute("data-index");
          if (event.target.classList.contains("btn-inc")) {
            updateQuantity(index, 1);
          } else if (event.target.classList.contains("btn-dec")) {
            updateQuantity(index, -1);
          }
        });

      // Update item quantity
function updateQuantity(index, change) {
  const cart = JSON.parse(sessionStorage.getItem("cart")) || [];
  cart[index].quantity += change;

  // Remove item if quantity is zero or less
  if (cart[index].quantity <= 0) {
    cart.splice(index, 1);
  } else {
    // Update the product_total for the item
    cart[index].product_total = cart[index].price * cart[index].quantity;
  }

  // Save the updated cart back to sessionStorage
  sessionStorage.setItem("cart", JSON.stringify(cart));
  
  // Re-render the cart items with the updated quantities
  renderCartItems(cart);
}

      // Render empty cart UI
      function renderEmptyCart() {
        const cartItemsContainer = document.getElementById(
          "cart-items-container"
        );
        cartItemsContainer.innerHTML = `
          <h3 class="text-center">Your cart is empty</h3>
          <div class="empty-cart-img-container">
            <img src="./img/cartimge.png" class="empty-cart-img" />
          </div>`;
      }

      // Confirm the order
      document
        .getElementById("continueButton")
        .addEventListener("click", async function () {
          const customerName = document
            .getElementById("customerName")
            .value.trim();
          const customerNumber = document
            .getElementById("customerNumber")
            .value.trim();

          if (!customerName || !customerNumber) {
            alert("Please fill in all the details.");
            return;
          }

          const orderDetails = {
            name: customerName,
            phone: customerNumber,
            items: JSON.parse(sessionStorage.getItem("cart")) || [],
            areaName: sessionStorage.getItem("areaName"),
          };

          console.log("Order Details:", orderDetails);

          try {
            await sendCartDataToServer(); // Call server to send cart data
            alert("Order confirmed! Your cart has been stored.");
          } catch (error) {
            console.error("Error placing order:", error);
            alert("Order confirmed, but there was an error storing your cart.");
          }
        });

      async function getTableId(areaName) {
        var tableId = "";
        var areaName = areaName;
        // alert(restaurant_id);
        var restaurantId = sessionStorage.getItem("restaurantId");
        console.log("area name: " + areaName);
        const token = sessionStorage.getItem("token");
        console.log("token");

        try {
          const response = await fetch(
            `https://app.extraaazpos.com/api/getTableId/${areaName}/${restaurantId}`,
            {
              method: "GET",
              headers: {
                Authorization: "Bearer " + token,
                "Content-Type": "application/json",
              },
            }
          );

          const data = await response.json();
          console.log("Data:", data);
          tableId = data;
          console.log(tableId);

          return tableId;
        } catch (error) {
          console.error("Error fetching TableId:", error);
          throw error;
        }
      }

      $('input[name="pilih"]').on("change", function () {
        // Get the value of the selected radio button
        var areaName = $('input[name="pilih"]:checked').val();

        sessionStorage.setItem("areaName", areaName);
        console.log("Selected Value:", areaName);
      });

      

      async function formatCartData(cartItems) {
        var areaName = sessionStorage.getItem("areaName"); //$('input[name="pilih"]:checked').val();
        console.log("Selected Value:", areaName);
        const tableId = await getTableId(areaName);
        console.log("TableId : ", tableId);
        const sectionName = areaName == "Dine-In" ? "AC / 1" : tableId; //? "AC / 1" should be selected from the area(QR) !!!
        const total = cartItems.reduce(
          (sum, item) => sum + item.product_total,
          0
        );

        const formattedProducts = cartItems.map((item) => ({
          product_id: item.id,
          productName: item.name,
          quantity: item.quantity.toString(),
          unitPrice: item.price.toString(),
          total: item.product_total.toString(), //(item.price * item.quantity).toString(),
          kotInstruction: null,
          status: "confirmed",
          foodType: item.item_food_type,
        }));

        // Return the formatted data
        return {
          cover_count: "1", // This will come in Dine-In when there will be number of customers
          table_id: tableId,
          location_id: sessionStorage.getItem("selectedLocationId"),
          restaurant_id: localStorage.getItem("urlSegment"),
          sectionName: sectionName,
          areaName: sessionStorage.getItem("areaName"),
          kitchenInstruction: null,
          billNote: null,
          internal_note: null,
          products: formattedProducts,
          total: total.toString(),
        };
      }

      async function sendCartDataToServer() {
        const apiUrl = "https://app.extraaazpos.com/api/storeToCart";
        const cartItems = JSON.parse(sessionStorage.getItem("cart")) || [];
        const formattedData = await formatCartData(cartItems);
        console.log("Formatted Data:", formattedData);
        const token = sessionStorage.getItem("token");
        fetch(apiUrl, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + token,
          },
          body: JSON.stringify(formattedData), // formattedData,//JSON.stringify({ cart: cartData }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              // alert('Order placed successfully!');
              window.location.href =
                "payment.html?tableId=" +
                JSON.stringify(formattedData.table_id);
              // sessionStorage.setItem('cart', null);
            } else {
              alert("Error placing order. Please try again.");
            }
          })
          .catch((error) => {
            console.error("Error sending cart data:", error);
            alert("Error sending cart data. Please try again.");
          });
      }
    </script> -->
    <script>
      let url;
    
      document.addEventListener("DOMContentLoaded", () => {
        loadEnvironmentVariables();
        loadSessionData();
        displayLocationName();
      });
    
      // Load environment variables from env.json
      // async function loadEnvironmentVariables() {
      //   try {
      //     const response = await fetch("/env.json");
      //     const data = await response.json();
      //     url = data.URL;
      //     restaurantId = localStorage.getItem("restaurantId");
      //     console.log("URL:", url, "Restaurant ID:", restaurantId);
      //     const locationId = sessionStorage.getItem("selectedLocationId");
      //     console.log("Location ID:", locationId);
      //   } catch (error) {
      //     console.error("Error fetching env.json:", error);
      //   }
      // }
    
      async function loadEnvironmentVariables() {
  try {
    const response = await fetch("/env.json");
    const data = await response.json();
    url = data.URL;

    // Save or retrieve `restaurantId` from sessionStorage
    let restaurantId = sessionStorage.getItem("restaurantId");
    if (!restaurantId) {
      restaurantId = localStorage.getItem("urlSegment");
      sessionStorage.setItem("restaurantId", restaurantId);
    }
    console.log("URL:", url, "Restaurant ID:", restaurantId);

    const locationId = sessionStorage.getItem("selectedLocationId");
    console.log("Location ID:", locationId);
  } catch (error) {
    console.error("Error fetching env.json:", error);
  }
}

      // Load session data and check areaName
      function loadSessionData() {
        const areaName = sessionStorage.getItem("areaName");
        if (!areaName) {
          window.location.href = "home.html"; // Redirect if areaName is not set
          return;
        }
        console.log("Area Name:", areaName);
    
        // Initialize cart in sessionStorage if not set
        if (!sessionStorage.getItem("cart")) {
          sessionStorage.setItem("cart", JSON.stringify([]));
        }
    
        loadCartItems(); // Load cart items after session data is confirmed
      }
    
      // Display location name in the UI
      function displayLocationName() {
        const location = sessionStorage.getItem("selectedLocationName");
        if (location) {
          document.getElementById("locationName").innerText = location;
        }
      }
    
      // Load and render cart items from sessionStorage
      function loadCartItems() {
        const cart = JSON.parse(sessionStorage.getItem("cart")) || [];
        renderCartItems(cart);
      }
    
      // Render cart items
      function renderCartItems(cart) {
        const cartItemsContainer = document.getElementById("cart-items-container");
        const totalPriceElement = document.getElementById("total-price");
        const payNowButtonSpan = document.querySelector(".item-subtotal span");
    
        cartItemsContainer.innerHTML = ""; // Clear previous cart content
        let totalPrice = 0;
    
        if (!Array.isArray(cart) || cart.length === 0) {
          renderEmptyCart(); // Display empty cart UI
          totalPriceElement.textContent = "0.00";
          payNowButtonSpan.textContent = `Pay ₹0.00`;
          return;
        }
    
        cart.forEach((cartItem, index) => {
          const itemDiv = createCartItemElement(cartItem, index);
          cartItemsContainer.appendChild(itemDiv);
          totalPrice += cartItem.price * cartItem.quantity; // Calculate total price
        });
    
        totalPriceElement.textContent = totalPrice.toFixed(2);
        payNowButtonSpan.textContent = `Pay ₹${totalPrice.toFixed(2)}`;
      }
    
      // Create a cart item element
      function createCartItemElement(cartItem, index) {
        const itemDiv = document.createElement("div");
        itemDiv.classList.add("cart-item");
    
        itemDiv.innerHTML = `
          <div class="p-3 border-bottom gold-members">
            <span class="count-number float-right">
              <button type="button" class="btn-sm left btn-dec btn btn-outline-secondary" data-index="${index}">-</button>
              <input class="count-number-input" type="text" readonly value="${cartItem.quantity}" />
              <button type="button" class="btn-sm right btn-inc btn btn-outline-secondary" data-index="${index}">+</button>
            </span>
            <div class="media">
              <div class="mr-3 font-weight-bold text-danger non_veg">.</div>
              <div class="media-body">
                <h6 class="mb-1">${cartItem.name}</h6>
                <p class="text-muted mb-0">₹<span class="item-price">${parseFloat(cartItem.price).toFixed(2)}</span></p>
              </div>
            </div>
          </div>`;
        
        return itemDiv;
      }
    
      // Handle quantity updates for cart items
      document
        .getElementById("cart-items-container")
        .addEventListener("click", (event) => {
          const index = event.target.getAttribute("data-index");
          if (event.target.classList.contains("btn-inc")) {
            updateQuantity(index, 1);
          } else if (event.target.classList.contains("btn-dec")) {
            updateQuantity(index, -1);
          }
        });
    
      // Update item quantity
      function updateQuantity(index, change) {
        const cart = JSON.parse(sessionStorage.getItem("cart")) || [];
        cart[index].quantity += change;
    
        // Remove item if quantity is zero or less
        if (cart[index].quantity <= 0) {
          cart.splice(index, 1);
        } else {
          // Update the product_total for the item
          cart[index].product_total = cart[index].price * cart[index].quantity;
        }
    
        // Save the updated cart back to sessionStorage
        sessionStorage.setItem("cart", JSON.stringify(cart));
        
        // Re-render the cart items with the updated quantities
        renderCartItems(cart);
      }
    
      // Render empty cart UI
      function renderEmptyCart() {
        const cartItemsContainer = document.getElementById("cart-items-container");
        cartItemsContainer.innerHTML = `
          <h3 class="text-center">Your cart is empty</h3>
          <div class="empty-cart-img-container">
            <img src="./img/cartimge.png" class="empty-cart-img" />
          </div>`;
      }
    
      // Confirm the order
      document
        .getElementById("continueButton")
        .addEventListener("click", async function () {
          const customerName = document
            .getElementById("customerName")
            .value.trim();
          const customerNumber = document
            .getElementById("customerNumber")
            .value.trim();
    
          if (!customerName || !customerNumber) {
            alert("Please fill in all the details.");
            return;
          }
    
          const orderDetails = {
            name: customerName,
            phone: customerNumber,
            items: JSON.parse(sessionStorage.getItem("cart")) || [],
            areaName: sessionStorage.getItem("areaName"),
          };
    
          console.log("Order Details:", orderDetails);
    
          try {
            await sendCartDataToServer(); // Call server to send cart data
            alert("Order confirmed! Your cart has been stored.");
          } catch (error) {
            console.error("Error placing order:", error);
            alert("Order confirmed, but there was an error storing your cart.");
          }
        });
    
      // async function getTableId(areaName) {
      //   var tableId = "";
      //   var areaName = areaName;
      //   var restaurantId = sessionStorage.getItem("restaurantId");
      //   const token = sessionStorage.getItem("token");
    
      //   try {
      //     const response = await fetch(
      //       `https://app.extraaazpos.com/api/getTableId/${areaName}/${restaurantId}`,
      //       {
      //         method: "GET",
      //         headers: {
      //           Authorization: "Bearer " + token,
      //           "Content-Type": "application/json",
      //         },
      //       }
      //     );
    
      //     const data = await response.json();
      //     tableId = data;
    
      //     return tableId;
      //   } catch (error) {
      //     console.error("Error fetching TableId:", error);
      //     throw error;
      //   }
      // }
    
      async function getTableId(areaName) {
  var tableId = "";
  const restaurantId = sessionStorage.getItem("restaurantId"); // Retrieve restaurantId from sessionStorage
  const token = sessionStorage.getItem("token");

  if (!restaurantId) {
    console.error("Error: restaurantId is not set.");
    return; // Stop the function if restaurantId is missing
  }

  try {
    const response = await fetch(
      `https://app.extraaazpos.com/api/getTableId/${areaName}/${restaurantId}`,
      {
        method: "GET",
        headers: {
          Authorization: "Bearer " + token,
          "Content-Type": "application/json",
        },
      }
    );

    const data = await response.json();
    console.log("Data:", data);
    tableId = data;

    return tableId;
  } catch (error) {
    console.error("Error fetching TableId:", error);
    throw error;
  }
}

      $('input[name="pilih"]').on("change", function () {
        var areaName = $('input[name="pilih"]:checked').val();
        sessionStorage.setItem("areaName", areaName);
      });
    
      async function formatCartData(cartItems) {
        var areaName = sessionStorage.getItem("areaName");
        const tableId = await getTableId(areaName);
        const sectionName = areaName == "Dine-In" ? "AC / 1" : tableId;
        const total = cartItems.reduce(
          (sum, item) => sum + item.product_total,
          0
        );
    
        const formattedProducts = cartItems.map((item) => ({
          product_id: item.id,
          productName: item.name,
          quantity: item.quantity.toString(),
          unitPrice: item.price.toString(),
          total: item.product_total.toString(),
          kotInstruction: null,
          status: "confirmed",
          foodType: item.item_food_type,
        }));
    
        return {
          cover_count: "1",
          table_id: tableId,
          location_id: sessionStorage.getItem("selectedLocationId"),
          restaurant_id: localStorage.getItem("urlSegment"),
          sectionName: sectionName,
          areaName: sessionStorage.getItem("areaName"),
          kitchenInstruction: null,
          billNote: null,
          internal_note: null,
          products: formattedProducts,
          total: total.toString(),
        };
      }
    
      // async function sendCartDataToServer() {
      //   const apiUrl = "https://app.extraaazpos.com/api/storeToCart";
      //   const cartItems = JSON.parse(sessionStorage.getItem("cart")) || [];
      //   const formattedData = await formatCartData(cartItems);
      //   const token = sessionStorage.getItem("token");
    
      //   fetch(apiUrl, {
      //     method: "POST",
      //     headers: {
      //       "Content-Type": "application/json",
      //       Authorization: "Bearer " + token,
      //     },
      //     body: JSON.stringify(formattedData),
      //   })
      //     .then((response) => response.json())
      //     .then((data) => {
      //       if (data.success) {
      //         console.log("Cart data sent successfully:", data);
      //       } else {
      //         console.error("Error sending cart data:", data);
      //       }
      //     })
      //     .catch((error) => {
      //       console.error("Error sending cart data:", error);
      //     });
      // }
      async function sendCartDataToServer() {
  const apiUrl = "https://app.extraaazpos.com/api/storeToCart";
  const cartItems = JSON.parse(sessionStorage.getItem("cart")) || [];
  const formattedData = await formatCartData(cartItems);
  console.log("Formatted Data:", formattedData);
  const token = sessionStorage.getItem("token");

  try {
    const response = await fetch(apiUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: "Bearer " + token,
      },
      body: JSON.stringify(formattedData),
    });

    const data = await response.json();

    if (data.success) {
      console.log("Cart data sent successfully:", data);
      
      // Navigate to payment.html with the tableId
      window.location.href =  "payment.html?tableId=" + JSON.stringify(formattedData.table_id);
    } else {
      console.error("Error placing order:", data.message);
      alert("Error placing order. Please try again.");
    }
  } catch (error) {
    console.error("Error sending cart data:", error);
    alert("Error sending cart data. Please try again.");
  }
}

    </script>
    
  </body>

  <!-- Mirrored from askbootstrap.com/preview/swiggi/checkout.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Sep 2024 06:30:23 GMT -->
</html>
